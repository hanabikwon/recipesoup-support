# Recipesoup 테스트 계획

## 테스트 전략
- **TDD (테스트 주도 개발)** 원칙 적용
- **테스트 피라미드**: 단위 테스트 > 위젯 테스트 > 통합 테스트
- **감정 기반 아카이빙**의 특성을 반영한 테스트 설계
- **오프라인 우선** 설계에 맞는 로컬 저장소 중심 테스트
- **OpenAI API 연동** 및 예외 케이스 완벽 테스트

## 테스트 환경
- **개발 환경**: Flutter 3.x
- **테스트 프레임워크**: Flutter Test + integration_test
- **모킹 라이브러리**: mockito + mocktail
- **브라우저 테스트**: puppeteer MCP (Chrome에서 Flutter Web 테스트)
- **이미지 테스트**: testimg1.jpg, testimg2.jpg, testimg3.jpg
- **테스트 디바이스**: 
  - Flutter Web (Chrome) - 주 테스트 환경
  - iOS 시뮬레이터 (iPhone 14)
  - Android 에뮬레이터 (Pixel 6)

## 1. 단위 테스트 (Unit Tests)

### 1.1 핵심 모델 테스트

#### Recipe 모델 테스트
- [ ] **Recipe 모델 기본 기능**
  - [ ] Recipe 생성자 테스트 (모든 필수 필드)
  - [ ] emotionalStory 필드 테스트 (감정 메모 핵심 기능)
  - [ ] Hive 직렬화/역직렬화 (toJson/fromJson)
  - [ ] copyWith 메서드 테스트
  - [ ] 필드 유효성 검증
  - [ ] 날짜 기반 정렬 테스트

#### Ingredient 모델 테스트  
- [ ] **구조화된 재료 모델**
  - [ ] Ingredient 생성자 테스트
  - [ ] 재료 카테고리 enum 테스트
  - [ ] 양과 단위 처리 테스트
  - [ ] JSON 직렬화 테스트

#### Mood enum 테스트
- [ ] **감정 상태 관리**
  - [ ] 모든 감정 상태 정의 확인 (happy, sad, peaceful 등)
  - [ ] 감정별 이모지 및 한국어/영어 매핑
  - [ ] enum index 저장/복원 테스트

### 1.2 서비스 테스트

#### OpenAI Service 테스트 (핵심!)
- [ ] **사진 기반 레시피 분석**
  - [ ] testimg1.jpg 분석 테스트 (성공 케이스)
  - [ ] testimg2.jpg 분석 테스트 (다른 음식)
  - [ ] testimg3.jpg 분석 테스트 (복잡한 요리)
  - [ ] 잘못된 이미지 파일 처리 (에러 케이스)
  - [ ] 네트워크 에러 처리
  - [ ] API 키 없음 에러 처리
  - [ ] 타임아웃 처리 (30초)
  - [ ] API 응답 파싱 테스트 (재료, 조리법 추출)

#### Hive Service 테스트
- [ ] **로컬 데이터베이스 CRUD**
  - [ ] Recipe 저장/조회/수정/삭제
  - [ ] 복수 레시피 일괄 처리
  - [ ] 날짜별 레시피 조회
  - [ ] 감정별 레시피 필터링
  - [ ] 태그 기반 검색
  - [ ] 데이터 마이그레이션 테스트
  - [ ] Box 초기화 및 정리

#### Image Service 테스트
- [ ] **로컬 이미지 관리**
  - [ ] 이미지 저장 (documents 디렉토리)
  - [ ] 이미지 불러오기
  - [ ] 이미지 삭제
  - [ ] 이미지 경로 관리
  - [ ] 용량 제한 테스트
  - [ ] 파일 형식 검증 (jpg, png)

#### Stats Service 테스트
- [ ] **개인 통계 분석**
  - [ ] 감정 분포 계산
  - [ ] 요리 패턴 분석 (태그 기반)
  - [ ] 연속 기록 계산
  - [ ] 월별/주별 통계
  - [ ] "과거 오늘" 레시피 검색
  - [ ] 즐겨찾기 레시피 통계

### 1.3 Provider 테스트

#### Recipe Provider 테스트
- [ ] **레시피 상태 관리**
  - [ ] 상태 초기화
  - [ ] 레시피 추가/수정/삭제 상태 변경
  - [ ] 로딩 상태 관리
  - [ ] 에러 상태 관리
  - [ ] 검색 결과 상태 관리
  - [ ] "과거 오늘" 레시피 상태
  - [ ] 즐겨찾기 토글 상태

#### Stats Provider 테스트
- [ ] **통계 상태 관리**
  - [ ] 감정 분포 상태 계산
  - [ ] 요리 패턴 상태 업데이트
  - [ ] 연속 기록 상태 관리
  - [ ] 상태 의존성 관리 (레시피 변경시 통계 업데이트)

### 1.4 유틸리티 테스트

#### Date Utils 테스트
- [ ] **"과거 오늘" 기능**
  - [ ] 같은 월/일, 다른 년도 검색
  - [ ] 날짜 포맷팅 (한국어)
  - [ ] 상대적 시간 표시 ("1시간 전", "3일 전")

#### Validators 테스트
- [ ] **입력 검증**
  - [ ] 레시피 제목 검증 (1-100자)
  - [ ] 감정 메모 검증 (1-1000자)
  - [ ] 태그 형식 검증 (#으로 시작)
  - [ ] 이미지 파일 검증

#### Image Utils 테스트  
- [ ] **이미지 처리**
  - [ ] 이미지 리사이징
  - [ ] Base64 인코딩 (OpenAI API용)
  - [ ] 이미지 압축

## 2. 위젯 테스트 (Widget Tests)

### 2.1 화면 테스트

#### 스플래시 화면 테스트
- [ ] **빈티지 로고 표시**
  - [ ] 빈티지 일러스트 로고 렌더링
  - [ ] "Recipesoup" 타이틀 표시
  - [ ] "감정 기반 레시피 아카이빙" 서브타이틀
  - [ ] 아이보리 배경색 적용 (#FAF8F3)
  - [ ] 로딩 애니메이션
  - [ ] 자동 메인 화면 전환 (2.5초)

#### Bottom Navigation 컨테이너 테스트
- [ ] **5탭 네비게이션**
  - [ ] 홈/검색/통계/보관함/설정 탭 표시
  - [ ] 탭 전환 동작
  - [ ] 현재 탭 하이라이트
  - [ ] 빈티지 아이보리 테마 적용

#### 홈 화면 테스트
- [ ] **개인 통계 및 최근 레시피**
  - [ ] 개인 통계 카드 렌더링
  - [ ] "과거 오늘" 섹션 표시 (데이터 있을 때)
  - [ ] 최근 레시피 리스트
  - [ ] 빈 상태 메시지 (첫 사용자용)
  - [ ] "첫 레시피 작성하기" 버튼

#### 검색 화면 테스트
- [ ] **감정 기반 검색**
  - [ ] 통합 검색바 (요리이름, 감정, 날짜)
  - [ ] 개인 태그 히스토리 표시
  - [ ] 감정별 카테고리 필터
  - [ ] 기간별 검색 필터
  - [ ] 검색 결과 카드 리스트

#### 통계 화면 테스트
- [ ] **개인 패턴 분석**
  - [ ] 요리 달력 표시
  - [ ] 감정 분포 차트
  - [ ] 개인 성취 통계
  - [ ] 감정 변화 추이 그래프

#### 보관함 화면 테스트
- [ ] **폴더별 정리**
  - [ ] 폴더별 레시피 그룹핑
  - [ ] 즐겨찾기 섹션
  - [ ] 기간별 보기
  - [ ] 폴더 생성/편집

#### 설정 화면 테스트
- [ ] **개인화 설정**
  - [ ] 프로필 카드
  - [ ] 알림 설정 토글
  - [ ] 테마 설정
  - [ ] 버전 정보 표시

#### 레시피 작성 화면 테스트
- [ ] **감정 중심 작성**
  - [ ] 사진 업로드 영역
  - [ ] 레시피 제목 입력
  - [ ] 감정 이야기 텍스트 영역 (가이드 질문 포함)
  - [ ] 재료 입력 (자유 형식)
  - [ ] 조리법 입력 (단계별)
  - [ ] 태그 입력
  - [ ] 감정 상태 선택
  - [ ] 평점 선택 (1-5점)

#### 레시피 상세보기 화면 테스트
- [ ] **개인 기록 중심 표시**
  - [ ] 메인 이미지 표시
  - [ ] 감정 이야기 표시 (이탤릭 강조)
  - [ ] 재료/조리법 탭 전환
  - [ ] 태그 표시
  - [ ] 작성일시 표시
  - [ ] 개인 관리 액션 (즐겨찾기, 폴더 이동 등)

### 2.2 컴포넌트 테스트

#### FAB 및 확장 메뉴 테스트
- [ ] **핵심 기능 접근**
  - [ ] 메인 FAB 렌더링 (빈티지 오렌지)
  - [ ] FAB 확장 애니메이션
  - [ ] "빠른 작성" 메뉴 아이템 (우선순위 1)
  - [ ] "사진으로 작성" 메뉴 아이템
  - [ ] "감정 체크" 메뉴 아이템
  - [ ] 각 메뉴 클릭 네비게이션

#### 빈티지 테마 컴포넌트 테스트
- [ ] **아이보리 색상 적용**
  - [ ] 카드 배경색 테스트
  - [ ] 텍스트 색상 테스트 (다크 올리브)
  - [ ] 버튼 색상 테스트 (올리브/브라운)
  - [ ] 그림자 및 elevation 테스트

#### 레시피 카드 테스트
- [ ] **카드형 레이아웃**
  - [ ] 이미지 표시
  - [ ] 제목 및 감정 메모 표시
  - [ ] 태그 표시
  - [ ] 날짜 표시
  - [ ] 카드 클릭 네비게이션

## 3. 통합 테스트 (Integration Tests)

### 3.1 핵심 사용자 시나리오

#### 시나리오 1: 첫 사용자 레시피 작성 플로우
- [ ] **바로 작성 유도 테스트**
  1. [ ] 앱 시작 → 스플래시 → 홈 화면
  2. [ ] 빈 상태 메시지 확인
  3. [ ] "첫 레시피 작성하기" 버튼 클릭
  4. [ ] 레시피 작성 화면 이동
  5. [ ] 감정 중심 작성 완료
  6. [ ] 홈 화면에서 작성된 레시피 확인

#### 시나리오 2: 사진 기반 레시피 작성 및 AI 분석
- [ ] **OpenAI API 연동 테스트**
  1. [ ] FAB → "사진으로 작성" 선택
  2. [ ] testimg1.jpg 업로드
  3. [ ] OpenAI API 사진 분석 대기
  4. [ ] 추천된 재료/조리법 확인
  5. [ ] 사용자 감정 메모 추가
  6. [ ] 저장 후 상세보기 확인

#### 시나리오 3: 감정 기반 검색 및 "과거 오늘" 기능
- [ ] **감정 아카이빙 특화 기능**
  1. [ ] 여러 레시피 작성 (다양한 감정)
  2. [ ] 검색 탭에서 감정별 필터링
  3. [ ] "1년 전 오늘" 레시피 표시 확인
  4. [ ] 감정 변화 통계 확인

### 3.2 오프라인 동작 테스트
- [ ] **완전 로컬 저장**
  - [ ] 네트워크 없이 앱 실행
  - [ ] 로컬 데이터만으로 모든 기능 동작
  - [ ] 이미지 로컬 저장 확인
  - [ ] API 없이도 기본 기능 사용 가능

### 3.3 데이터 영속성 테스트
- [ ] **Hive 데이터 지속성**
  - [ ] 앱 재시작 후 데이터 유지
  - [ ] 레시피 수정 후 상태 유지
  - [ ] 통계 데이터 정확성 유지

## 4. 브라우저 테스트 (Puppeteer MCP)

### 4.1 Flutter Web 빌드 테스트
- [ ] **웹 호환성 테스트**
  - [ ] `flutter build web` 성공
  - [ ] Chrome에서 앱 실행
  - [ ] 모든 화면 정상 렌더링
  - [ ] 터치/클릭 이벤트 동작

### 4.2 실제 음식 사진 분석 테스트 (핵심!)
```javascript
// puppeteer MCP 테스트 시나리오
test('음식 사진 OpenAI 분석 테스트', async () => {
  // 1. testimg1.jpg 업로드 테스트
  await page.click('#fab_photo_recipe');
  await page.setInputFiles('#photo_upload', './testimg1.jpg');
  await page.waitForSelector('#analysis_result');
  
  // 2. API 응답 검증
  const ingredients = await page.textContent('#suggested_ingredients');
  expect(ingredients).toContain('재료명');
  
  // 3. testimg2.jpg, testimg3.jpg 동일 테스트
});
```

- [ ] **testimg1.jpg 분석 테스트**
  - [ ] 이미지 업로드 UI 동작
  - [ ] OpenAI API 호출 확인
  - [ ] 응답 데이터 파싱 확인
  - [ ] 추천 재료 표시 확인
  - [ ] 추천 조리법 표시 확인

- [ ] **testimg2.jpg 분석 테스트**  
  - [ ] 다른 음식 사진 분석 정확성
  - [ ] 한국어 재료명 변환 확인

- [ ] **testimg3.jpg 분석 테스트**
  - [ ] 복잡한 요리 사진 처리
  - [ ] 에러 케이스 처리 확인

### 4.3 사용자 인터랙션 테스트
- [ ] **puppeteer 자동화 테스트**
  - [ ] Bottom Navigation 탭 전환
  - [ ] FAB 확장 메뉴 동작
  - [ ] 레시피 카드 클릭 네비게이션
  - [ ] 검색 기능 동작
  - [ ] 폼 입력 및 제출

## 5. 성능 테스트

### 5.1 로컬 데이터 처리 성능
- [ ] **Hive 성능 테스트**
  - [ ] 1000개 레시피 저장/조회 시간
  - [ ] 복합 검색 쿼리 성능
  - [ ] 대용량 이미지 처리 시간

### 5.2 OpenAI API 성능
- [ ] **API 응답 시간 테스트**
  - [ ] 이미지 분석 평균 응답 시간 (< 10초)
  - [ ] 동시 API 호출 제한 테스트
  - [ ] 타임아웃 시나리오 테스트

## 6. 접근성 및 사용성 테스트

### 6.1 빈티지 테마 접근성
- [ ] **색상 대비 테스트**
  - [ ] 아이보리 배경 위 텍스트 가독성
  - [ ] 올리브/브라운 색상 대비 확인
  - [ ] WCAG AA 기준 준수

### 6.2 감정 기반 UX
- [ ] **첫 사용자 경험**
  - [ ] 빈 상태에서 작성 유도 효과
  - [ ] 감정 메모 작성 가이드 효과
  - [ ] "과거 오늘" 기능 발견 가능성

## 테스트 실행 계획

### 자동화 테스트 실행
```bash
# 단위 테스트
flutter test

# 위젯 테스트  
flutter test test/widget_test/

# 통합 테스트
flutter test integration_test/

# 웹 빌드 및 브라우저 테스트
flutter build web
# -> Chrome에서 localhost:8080 접속
# -> puppeteer MCP로 음식 사진 분석 테스트 실행
```

### Puppeteer MCP 테스트 스크립트
```javascript
// 음식 사진 분석 자동화 테스트
const testImageAnalysis = async (imagePath, expectedKeywords) => {
  await page.goto('http://localhost:8080');
  await page.click('#fab_photo_recipe');
  await page.setInputFiles('#photo_input', imagePath);
  
  // OpenAI API 응답 대기
  await page.waitForSelector('#analysis_result', { timeout: 15000 });
  
  // 결과 검증
  const result = await page.textContent('#analysis_result');
  expectedKeywords.forEach(keyword => {
    expect(result).toContain(keyword);
  });
};

// 3개 이미지 테스트 실행
await testImageAnalysis('./testimg1.jpg', ['재료', '조리법']);
await testImageAnalysis('./testimg2.jpg', ['재료', '조리법']);  
await testImageAnalysis('./testimg3.jpg', ['재료', '조리법']);
```

## 테스트 커버리지 목표
- **전체**: 85% 이상
- **OpenAI Service**: 95% 이상 (핵심 기능)
- **Recipe/Mood 모델**: 90% 이상
- **Provider**: 85% 이상  
- **UI 위젯**: 75% 이상

## 테스트 완료 기준
- [ ] 모든 단위 테스트 PASS (100%)
- [ ] 모든 위젯 테스트 PASS (100%)
- [ ] 핵심 통합 시나리오 PASS (100%)
- [ ] 음식 사진 분석 테스트 PASS (testimg1,2,3 모두)
- [ ] Flutter Web에서 puppeteer 테스트 PASS
- [ ] 커버리지 목표 달성
- [ ] 성능 기준 만족

## 테스트 데이터 의존성
- **이미지 파일**: testimg1.jpg, testimg2.jpg, testimg3.jpg
- **OpenAI API**: 유효한 API 키 필요
- **테스트 환경**: Chrome 브라우저 + puppeteer MCP
- **샘플 데이터**: @TESTDATA.md 참조

---
*이 테스트 계획은 감정 기반 레시피 아카이빙의 특성을 반영하여 작성되었으며, 모든 테스트는 TDD 원칙에 따라 구현 전 작성되어야 합니다.*